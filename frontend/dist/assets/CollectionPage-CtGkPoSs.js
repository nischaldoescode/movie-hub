import{e as G,f as O,u as W,r as o,j as e,S as q,a as H}from"./main-F7ziLQoi.js";import{M as J}from"./MovieGrid-CLBAFS1P.js";import{F as K}from"./FilterBar-DYIdnglf.js";import{C as L,P as X}from"./Pagination-DQB3PF0B.js";import"./star-BSpultc5.js";import"./chevron-down-GrT9Hr23.js";const re=()=>{const b=G(),k=O(),h=new URLSearchParams(b.search),{searchMovies:T,discoverMovies:M,discoverTVShows:E}=W(),r=h.get("mediaType")||"movie",[S,F]=o.useState([]),[R,m]=o.useState(!0),[N,v]=o.useState(null),[n,P]=o.useState(""),[i,_]=o.useState(!1),[u,d]=o.useState(parseInt(h.get("page"))||1),[V,$]=o.useState(0),z={action:"28",comedy:"35",drama:"18",horror:"27",scifi:"878"},I=h.get("category")||"all",y=z[I]||I,g=h.get("region")||"all",w=h.get("sort")||"popularity";o.useEffect(()=>{(async()=>{if(!i)try{m(!0),v(null);const s=500,a={page:Math.min(u,s),sort_by:w==="popularity"?"popularity.desc":w==="rating"?"vote_average.desc":"release_date.desc","vote_count.gte":20};g==="in"?a.with_original_language="hi":g==="us"?a.with_original_language="en":g==="kr"?a.with_original_language="ko":g==="jp"&&(a.with_original_language="ja"),y!=="all"&&(a.with_genres=y);let l;r==="tvshow"?l=await E(a):l=await M(a);const j=l.results.filter(x=>x.poster_path),c=r==="tvshow"?j.map(x=>({...x,media_type:"tv"})):j.map(x=>({...x,media_type:"movie"}));F(c);const D=Math.min(l.total_pages||1,s);$(D),m(!1)}catch{v(`Failed to load ${r==="tvshow"?"TV shows":"movies"}. Please try again later.`),m(!1)}})()},[y,g,w,u,i,r,M,E]),o.useEffect(()=>{(async()=>{if(!(!i||!n.trim()))try{m(!0),v(null);const s=500,p=Math.min(u,s),a=await T(n,p);let l=a.results.filter(c=>c.poster_path);r==="tvshow"?l=l.filter(c=>c.media_type==="tv"):l=l.filter(c=>c.media_type==="movie"),F(l);const j=Math.min(a.total_pages||1,s);$(j),m(!1)}catch{v("Search failed. Please try again."),m(!1)}})()},[n,u,i,r,T]);const Q=async t=>{t.preventDefault(),n.trim()&&(_(!0),f({page:1,search:n}),d(1))},U=t=>{d(t),f({page:t}),window.scrollTo(0,0)},A=()=>{P(""),_(!1),f({page:1,search:null}),d(1)},f=t=>{const s=new URLSearchParams(b.search);Object.entries(t).forEach(([p,a])=>{a===null?s.delete(p):s.set(p,a)}),k(`${b.pathname}?${s.toString()}`,{replace:!0})},C=(t,s)=>{f({[t]:s,page:1}),d(1)},B=()=>{f({category:"all",region:"all",sort:"popularity",page:1}),d(1)};return o.useEffect(()=>{const t=h.get("search");t&&(P(t),_(!0))},[]),o.useEffect(()=>{window.scrollTo(0,0)},[]),e.jsx("div",{className:"min-h-screen bg-gray-900 text-white",children:e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:r==="tvshow"?"TV Shows Collection":"Movie Collection"}),e.jsx("form",{onSubmit:Q,className:"mb-6",children:e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",placeholder:`Search for ${r==="tvshow"?"TV shows":"movies"}...`,className:"w-full bg-gray-800 text-white rounded-full py-3 px-5 pl-12 focus:outline-none focus:ring-2 focus:ring-blue-500",value:n,onChange:t=>P(t.target.value)}),e.jsx("button",{type:"submit",className:"absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400",children:e.jsx(q,{size:18})})]})}),i&&e.jsxs("div",{className:"flex items-center mb-4 bg-blue-900/30 px-4 py-2 rounded-lg",children:[e.jsxs("span",{className:"mr-2",children:["Searching for: ",e.jsx("strong",{children:n})]}),e.jsx("button",{onClick:A,className:"ml-auto text-xs bg-blue-700 hover:bg-blue-800 px-2 py-1 rounded transition-colors",children:"Clear Search"})]}),e.jsx(K,{category:y,region:g,sort:w,onCategoryChange:t=>C("category",t),onRegionChange:t=>C("region",t),onSortChange:t=>C("sort",t),onClearAll:B,disabled:i}),R&&e.jsx(H,{}),N&&e.jsxs("div",{className:"flex items-center justify-center py-10 text-center",children:[e.jsx(L,{className:"text-red-500 mr-2",size:24}),e.jsx("p",{className:"text-red-500",children:N})]}),!R&&!N&&e.jsxs(e.Fragment,{children:[e.jsx(J,{movies:S}),S.length===0&&e.jsxs("div",{className:"text-center py-16",children:[e.jsx("div",{className:"mb-4",children:e.jsx(L,{className:"mx-auto text-yellow-500",size:48})}),e.jsxs("h2",{className:"text-xl font-semibold mb-2",children:["No ",r==="tvshow"?"TV shows":"movies"," found"]}),e.jsx("p",{className:"text-gray-400",children:i?`We couldn't find any ${r==="tvshow"?"TV shows":"movies"} matching "${n}".`:`No ${r==="tvshow"?"TV shows":"movies"} match your selected filters.`}),i&&e.jsx("button",{onClick:A,className:"mt-4 bg-blue-600 hover:bg-blue-700 text-white py-2 px-6 rounded-full transition-colors duration-300",children:"Clear Search"})]}),V>1&&S.length>0&&e.jsx(X,{currentPage:u,totalPages:V,onPageChange:U})]})]})})};export{re as default};
